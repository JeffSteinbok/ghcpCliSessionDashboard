<!DOCTYPE html>
<html lang="en" data-mode="dark" data-palette="default">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Copilot Dashboard</title>
<link rel="icon" href="/favicon.png" type="image/png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0d1117">
<script>if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/sw.js'); }</script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
  <img src="/favicon.png" style="width:32px;height:32px;border-radius:50%;margin-right:4px;vertical-align:middle">
  <h1>Copilot Dashboard</h1>
  <span id="waiting-badge" style="display:none" title="Sessions waiting for input"></span>
  <div class="header-credits">
    Created by <strong><a href="https://github.com/JeffSteinbok" target="_blank">Jeff Steinbok</a></strong>
    &nbsp;&bull;&nbsp; v{{ version }}
    &nbsp;&bull;&nbsp;
    <a onclick="document.getElementById('help-modal').classList.add('open')">What is this?</a>
  </div>
  <div class="header-right">
    <input id="search-input" type="search" placeholder="ðŸ” Search sessions..." style="padding:6px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:13px;width:200px">
    <div class="theme-controls">
      <button class="theme-btn" id="mode-toggle" title="Toggle light/dark mode">&#x1F319; Dark</button>
      <select class="palette-select" id="palette-select" title="Color palette">
        <option value="default">&#x1F308; Default</option>
        <option value="pink">&#x1F338; Pink</option>
      </select>
    </div>
    <div class="header-meta">
      <span class="refresh-dot"></span>
      <span id="last-updated">-</span>
    </div>
  </div>
</div>

<!-- ===== HELP MODAL ===== -->
<div class="modal-overlay" id="help-modal" onclick="if(event.target===this)this.classList.remove('open')">
  <div class="modal">
    <h2>&#x1F916; Copilot Dashboard</h2>
    <p>A local dashboard that monitors all your GitHub Copilot CLI sessions in real-time.</p>
    <p><a href="https://github.com/JeffSteinbok/ghcpCliDashboard" target="_blank" style="color:var(--accent);text-decoration:underline">&#x1F4D6; View full documentation on GitHub</a></p>
    <p><strong>Features:</strong></p>
    <ul>
      <li><strong>Active vs Previous</strong> &mdash; sessions with a running process show in the Active tab with a live indicator; completed sessions are in Previous.</li>
      <li><strong>Session states</strong> &mdash; <span style="color:var(--green)">&#x25CF; Working/Thinking</span> (actively running), <span style="color:var(--yellow)">&#x25CF; Waiting</span> (needs your input), <span style="color:var(--accent)">&#x25CF; Idle</span> (done, ready for next task).</li>
      <li><strong>Desktop notifications</strong> &mdash; click the &#x1F515; button to enable browser notifications. You'll get an alert whenever a session transitions from working to waiting or idle, so you can stay on top of sessions that need attention.</li>
      <li><strong>Background tasks</strong> &mdash; sessions running subagents show a badge with the count of active background tasks.</li>
      <li><strong>Grouped by project</strong> &mdash; sessions are automatically categorized by repository or working directory.</li>
      <li><strong>Restart commands</strong> &mdash; each session has a copy-pasteable <code>copilot</code> command to resume it.</li>
      <li><strong>Focus window</strong> &mdash; click the &#x1F4FA; button on an active session to bring its terminal to the foreground.</li>
      <li><strong>Tile &amp; List views</strong> &mdash; tile view for at-a-glance status, list view for full details. Click any tile/row to expand.</li>
      <li><strong>Themes</strong> &mdash; toggle light/dark mode and switch color palettes using the controls in the header.</li>
    </ul>
    <p><strong>Refresh rates:</strong> Active sessions refresh every 5 seconds. Previous sessions refresh every 30 seconds.</p>
    <button class="close-btn" onclick="document.getElementById('help-modal').classList.remove('open')">Got it</button>
  </div>
</div>

<!-- ===== DETAIL MODAL (for tile view) ===== -->
<div class="detail-modal-overlay" id="detail-modal" onclick="if(event.target===this)closeDetailModal()">
  <div class="detail-modal">
    <div class="detail-modal-header">
      <h2 id="detail-modal-title"></h2>
      <button class="close-x" onclick="closeDetailModal()">&#x2715;</button>
    </div>
    <div id="detail-modal-body"></div>
  </div>
</div>

<!-- ===== MAIN CONTENT ===== -->
<div class="container">
  <div class="stats-row" id="stats-row"></div>

  <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
    <div class="tabs" style="margin-bottom:0;flex:1">
      <div class="tab active" data-tab="active" onclick="switchTab('active')">
        &#x26A1; Active <span class="count" id="active-count">0</span>
      </div>
      <div class="tab" data-tab="previous" onclick="switchTab('previous')">
        &#x1F4CB; Previous <span class="count" id="previous-count">0</span>
      </div>
      <div class="tab" data-tab="files" onclick="switchTab('files')">
        &#x1F4C1; Files
      </div>
      <div class="tab" data-tab="timeline" onclick="switchTab('timeline')">
        &#x1F4C5; Timeline
      </div>
    </div>
    <div class="view-toggle">
      <div id="notif-wrap">
        <button class="view-btn" id="notif-btn" onclick="enableNotifications()" onmouseenter="showNotifHint()" onmouseleave="hideNotifHint()">&#x1F515; Notifications Off</button>
        <div class="notif-popover" id="notif-popover"></div>
      </div>
      <button class="view-btn active" id="view-tile" onclick="setView('tile')" title="Tile view">&#x25A6;</button>
      <button class="view-btn" id="view-list" onclick="setView('list')" title="List view">&#x2630;</button>
    </div>
  </div>

  <input class="search-bar" id="search" type="text"
         placeholder="&#x1F50D;  Filter sessions by name, repo, branch, MCP server, or directory...">

  <div class="tab-panel active" id="panel-active">
    <div class="loading" id="active-loading">Loading active sessions...</div>
  </div>
  <div class="tab-panel" id="panel-previous">
    <div class="loading" id="previous-loading">Loading sessions...</div>
  </div>
  <div class="tab-panel" id="panel-files">
    <div class="loading" id="files-loading">Loading files...</div>
  </div>
  <div class="tab-panel" id="panel-timeline"></div>
</div>

<!-- ===== DISCONNECT OVERLAY ===== -->
<div id="disconnect-overlay" class="disconnect-overlay" style="display:none">
  <div class="disconnect-popover">
    <div class="disconnect-icon">&#x26A0;&#xFE0F;</div>
    <div class="disconnect-title">Server Not Responding</div>
    <div class="disconnect-detail" id="disconnect-detail"></div>
    <div class="disconnect-retry" id="disconnect-retry"></div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
